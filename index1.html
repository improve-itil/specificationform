<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>טופס אפיון הדרכתי</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            direction: rtl;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold;
            color: #555;
        }
        
        input, textarea, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s;
            box-sizing: border-box;
        }
        
        input:focus, textarea:focus, select:focus {
            outline: none;
            border-color: #4CAF50;
        }
        
        textarea {
            resize: vertical;
            min-height: 100px;
        }
        
        button {
            background-color: #4CAF50;
            color: white;
            padding: 15px 30px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }
        
        button:hover:not(:disabled) {
            background-color: #45a049;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        
        .loader {
            display: none;
            text-align: center;
            margin: 20px 0;
        }
        
        .loader-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4CAF50;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .message {
            padding: 15px;
            margin: 20px 0;
            border-radius: 5px;
            display: none;
        }
        
        .message.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .message.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .message.warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
    </style>
</head>
<body>
    <div class="container">
          <center>
          <a href="http://www.improve-it.co.il/">
            <img src="logo-improve-it.png" alt="Improve-IT logo" />
          </a>
        </center>
        <h1>טופס אפיון הדרכתי</h1>
        
        <div id="message" class="message"></div>
        
        <form id="specificationForm" action="https://script.google.com/macros/s/AKfycbyWIT5eduutFBVSwfOBW8hFvIc9Hv44vRJ_txjXcwDCEz8rg19xznxC4m4efn7WuaSAiw/exec" method="POST">
            <div class="form-group">
                <label for="unit_name">שם היחידה:</label>
                <input type="text" id="unit_name" name="שם היחידה" required>
            </div>
            
            <div class="form-group">
                <label for="training_classification">סיווג ההדרכה:</label>
                <select id="training_classification" name="סיווג ההדרכה" required>
                    <option value="">בחר סיווג</option>
                    <option value="בסיסי">בסיסי</option>
                    <option value="מתקדם">מתקדם</option>
                    <option value="מקצועי">מקצועי</option>
                    <option value="ניהולי">ניהולי</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="content_expert">שם מומחה התוכן:</label>
                <input type="text" id="content_expert" name="שם מומחה התוכן" required>
            </div>
            
            <div class="form-group">
                <label for="training_subject">נושא/תחום ההדרכה:</label>
                <textarea id="training_subject" name="נושא/תחום ההדרכה" required></textarea>
            </div>
            
            <div class="form-group">
                <label for="training_type">האם ההדרכה עצמאית או חלק מרצף?</label>
                <select id="training_type" name="האם ההדרכה עצמאית או חלק מרצף?" required>
                    <option value="">בחר אפשרות</option>
                    <option value="עצמאית">עצמאית</option>
                    <option value="חלק מרצף">חלק מרצף</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="development_type">סוג הפיתוח הנדרש:</label>
                <textarea id="development_type" name="סוג הפיתוח הנדרש"></textarea>
            </div>
            
            <div class="form-group">
                <label for="current_delivery">איך ההדרכה הועברה עד עכשיו?</label>
                <textarea id="current_delivery" name="איך ההדרכה הועברה עד עכשיו?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="delivery_time">מהו זמן העברת ההדרכה?</label>
                <input type="text" id="delivery_time" name="מהו זמן העברת ההדרכה?">
            </div>
            
            <div class="form-group">
                <label for="training_gap">מהו הפער ההדרכתי?</label>
                <textarea id="training_gap" name="מהו הפער ההדרכתי?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="preserve_points">נקודות לשימור בהדרכה הנוכחית:</label>
                <textarea id="preserve_points" name="נקודות לשימור בהדרכה הנוכחית"></textarea>
            </div>
            
            <div class="form-group">
                <label for="target_audience">מאפייני אוכלוסיית היעד:</label>
                <textarea id="target_audience" name="מאפייני אוכלוסיית היעד"></textarea>
            </div>
            
            <div class="form-group">
                <label for="training_goal">מהי מטרת ההדרכה?</label>
                <textarea id="training_goal" name="מהי מטרת ההדרכה?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="key_messages">מסרים מרכזיים ודגשים:</label>
                <textarea id="key_messages" name="מסרים מרכזיים ודגשים"></textarea>
            </div>
            
            <div class="form-group">
                <label for="content_priority">תכנים קריטיים ופחות קריטיים:</label>
                <textarea id="content_priority" name="תכנים קריטיים ופחות קריטיים"></textarea>
            </div>
            
            <div class="form-group">
                <label for="literature">ספרות מקצועית שעליה מתבססים:</label>
                <textarea id="literature" name="ספרות מקצועית שעליה מתבססים"></textarea>
            </div>
            
            <div class="form-group">
                <label for="content_updates">האם יש עדכונים צפויים לתוכן?</label>
                <select id="content_updates" name="האם יש עדכונים צפויים לתוכן?">
                    <option value="">בחר אפשרות</option>
                    <option value="כן">כן</option>
                    <option value="לא">לא</option>
                    <option value="לא ידוע">לא ידוע</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="security_classification">האם יש סיווג ביטחוני?</label>
                <select id="security_classification" name="האם יש סיווג ביטחוני?">
                    <option value="">בחר אפשרות</option>
                    <option value="כן">כן</option>
                    <option value="לא">לא</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="effectiveness_evaluation">איך תוערך האפקטיביות של ההדרכה?</label>
                <textarea id="effectiveness_evaluation" name="איך תוערך האפקטיביות של ההדרכה?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="similar_product">האם יש תוצר הדרכתי דומה קיים?</label>
                <textarea id="similar_product" name="האם יש תוצר הדרכתי דומה קיים?"></textarea>
            </div>
            
            <div class="form-group">
                <label for="design_preferences">העדפות/מגבלות עיצוב:</label>
                <textarea id="design_preferences" name="העדפות/מגבלות עיצוב"></textarea>
            </div>
            
            <div class="form-group">
                <label for="timeline">לוחות זמנים ודד-ליין:</label>
                <textarea id="timeline" name="לוחות זמנים ודד-ליין"></textarea>
            </div>
            
            <div class="form-group">
                <label for="additional_notes">הערות נוספות:</label>
                <textarea id="additional_notes" name="הערות נוספות"></textarea>
            </div>
            
            <div class="loader" id="loader">
                <div class="loader-spinner"></div>
                <p>שולח נתונים...</p>
            </div>
            
            <button type="submit" id="submitBtn">שלח טופס</button>
        </form>
    </div>

    <script>
        // פונקציה להצגת הלודר
        function showLoader() {
            const loader = document.getElementById('loader');
            const submitBtn = document.getElementById('submitBtn');
            
            if (loader) {
                loader.style.display = 'block';
            }
            if (submitBtn) {
                submitBtn.disabled = true;
                submitBtn.textContent = 'שולח...';
            }
        }
        
        // פונקציה להסתרת הלודר
        function hideLoader() {
            const loader = document.getElementById('loader');
            const submitBtn = document.getElementById('submitBtn');
            
            if (loader) {
                loader.style.display = 'none';
            }
            if (submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = 'שלח טופס';
            }
        }
        
        // פונקציה להצגת הודעות
        function showMessage(text, type = 'success') {
            const messageDiv = document.getElementById('message');
            if (messageDiv) {
                messageDiv.textContent = text;
                messageDiv.className = `message ${type}`;
                messageDiv.style.display = 'block';
                
                // גלילה להודעה
                messageDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
                
                // הסתרת ההודעה אחרי 10 שניות
                setTimeout(() => {
                    messageDiv.style.display = 'none';
                }, 10000);
            }
        }
        
        // פונקציה לאיפוס הטופס
        function resetForm() {
            const form = document.getElementById('specificationForm');
            if (form) {
                form.reset();
            }
        }
        
        // טיפול בשליחת הטופס
        document.getElementById('specificationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            showLoader();
            
            const formData = new FormData(this);
            const data = {};
            
            // המרת FormData לאובייקט
            for (let [key, value] of formData.entries()) {
                data[key] = value;
            }
            
            console.log('Sending data:', data);
            
            // שליחת הנתונים לשרת
            fetch(this.action || window.location.href, {
                method: 'POST',
                body: formData
            })
            .then(response => {
                console.log('Response status:', response.status);
                return response.text();
            })
            .then(result => {
                console.log('Result:', result);
                hideLoader();
                
                try {
                    const jsonResult = JSON.parse(result);
                    
                    if (jsonResult.status === 'success') {
                        showMessage('הטופס נשלח בהצלחה! המסמך נוצר בהצלחה.', 'success');
                        resetForm();
                    } else if (jsonResult.status === 'partial') {
                        showMessage('הנתונים נשמרו בגיליון, אך יש בעיה ביצירת המסמך: ' + jsonResult.message, 'warning');
                    } else {
                        showMessage('שגיאה: ' + jsonResult.message, 'error');
                    }
                } catch (parseError) {
                    console.log('Parse error:', parseError);
                    
                    if (result.includes('OK') || result.includes('success')) {
                        showMessage('הטופס נשלח בהצלחה!', 'success');
                        resetForm();
                    } else {
                        showMessage('הטופס נשלח, אך התקבלה תגובה לא צפויה מהשרת.', 'warning');
                    }
                }
            })
            .catch(error => {
                console.error('Error:', error);
                hideLoader();
                showMessage('שגיאה בשליחת הטופס: ' + error.message, 'error');
            });
        });
        
        // הוספת validation נוסף
        document.addEventListener('DOMContentLoaded', function() {
            const requiredFields = document.querySelectorAll('[required]');
            
            requiredFields.forEach(field => {
                field.addEventListener('blur', function() {
                    if (!this.value.trim()) {
                        this.style.borderColor = '#dc3545';
                    } else {
                        this.style.borderColor = '#28a745';
                    }
                });
            });
        });
    </script>
</body>
</html>
